/**
 ******************************************************************************
 * File Name          : main.c
 * Description        : Main program body
 ******************************************************************************
 */
#include <string.h>
#include "board.h"
#include "hal_key.h"
#include "tim-board.h"
#include "timer_handles.h"

int modeId = 0,keyID = 0;

// 59*48
unsigned char bmp1[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0xF0,0xF0,
0xF8,0xF8,0x78,0x78,0x7C,0x3C,0xBE,0xBE,0xBE,0xBE,0xBE,0xBE,0xBE,0xBE,0xBE,0xBE,
0xBE,0xBE,0xBE,0xBE,0xBE,0x3E,0x7E,0x7C,0x7C,0xF8,0xF8,0xF0,0xF0,0xE0,0xE0,0xC0,
0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xC0,0xF0,0xF8,0xFC,0xFE,0xFF,0x1F,0x0F,0xE7,0xF3,0xF9,0xF8,0xFC,0x7E,0x7E,0x3F,
0x1F,0x0F,0x0F,0x0F,0x0F,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x0F,0x0F,0x0F,
0x1F,0x1F,0x3E,0x7E,0xFC,0xFC,0xF9,0xF1,0xE3,0xC7,0x1F,0x3F,0xFF,0xFE,0xFE,0xF8,
0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,
0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xF0,0xF8,0xFC,0xFC,0x3C,0x3C,0xFC,0xFC,0xFC,
0xF8,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0xFE,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x1F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,
0x1F,0x00,0x00,0x1F,0x3F,0x3F,0x3F,0x3F,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,
0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3F,0x3F,0x3F,0x3F,0x3F,0x1F,0x00,0x00,0xFF,0xFF,
0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x07,0x07,0x07,
0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,
0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,
0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x03,0x00,0x00,
0x00,0x00,
};

// 64*64
unsigned char bmp2[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0xFC,0xFE,0xFC,0xFE,0xBE,
0x1E,0x3E,0xFE,0xFE,0xFE,0xFC,0xF8,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,
0x00,0x00,0x7C,0xFF,0xFF,0xFF,0xFF,0xFF,0xEF,0xCF,0x9F,0x1F,0xBF,0xFF,0xFF,0xFE,
0xFC,0xF8,0xF0,0xF0,0xF0,0xF0,0xF8,0xF8,0x78,0x78,0x7F,0x7F,0x7F,0x7F,0x7F,0x7D,
0x7C,0x7C,0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,0x78,0x78,0xF8,0xF8,0xF0,0xF0,0xF0,0xF0,
0xF8,0xFC,0xFE,0xFF,0xFF,0x3F,0x9F,0x8F,0xCF,0xEF,0xFF,0xFF,0xFF,0xFF,0xFE,0x00,
0x00,0x00,0x00,0x00,0x01,0xC3,0xC7,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0x1F,0x8F,0xCF,
0xE3,0xF3,0xF3,0xF9,0xF9,0xFC,0xFC,0x7E,0x3E,0x3E,0x1E,0x1E,0x1F,0x1F,0x1F,0x1F,
0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1E,0x3E,0x3E,0x3E,0x7C,0xFC,0xFC,0xF9,0xF9,0xF3,
0xF3,0xE7,0x8F,0x9F,0x3F,0x7F,0xFF,0xFF,0xFF,0xFF,0xE7,0x87,0x03,0x01,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x03,0x00,0xF8,0xFC,0xFF,0xFF,
0xFF,0xFF,0xC7,0xE3,0xF1,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xE0,0xE0,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x0F,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFC,0x00,0x03,0xEF,0xFF,0xFF,0xFF,0xFF,0xF8,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x01,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF0,
0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x3F,0x3F,0x7F,0x7F,0x7F,0x78,0x78,0x79,0x79,0x79,0x79,
0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x78,0x78,0x78,0x79,0x79,0x79,0x79,0x79,0x79,
0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,
0x79,0x79,0x79,0x79,0x78,0x78,0x78,0x7B,0x7F,0x7F,0x7F,0x7F,0x3F,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};

// 63*64
unsigned char bmp3[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xF0,0xF0,0xF8,
0xF8,0xF8,0xF8,0xF8,0xF0,0xF0,0xF0,0xE0,0xC0,0xC0,0xF0,0xF0,0xF0,0xF8,0xF0,0xF8,
0xF8,0xF8,0xF0,0xF0,0xE0,0xC0,0xE0,0xF0,0xF0,0xF0,0xF8,0xF8,0xF8,0xF8,0xF0,0xF0,
0xF0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0xFC,0xFC,0xFC,0xFE,0xFE,0xBE,0x3E,0x7E,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFE,0xF0,0xF0,0xF7,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF0,0xF0,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF7,0xF0,0xF0,0xFC,0xFE,0xFF,0xFF,0xFF,
0xFF,0x7E,0x7E,0x3E,0x1E,0xFE,0xFE,0xFE,0xFC,0xFC,0xF8,0x00,0x00,0x00,0x00,0x00,
0x00,0x03,0x03,0x07,0x8F,0xFF,0xFF,0xFF,0xFE,0xFE,0x7F,0x3F,0x1F,0x8F,0xCF,0xE7,
0xE7,0xF3,0xF3,0xF3,0xFB,0xFD,0x7D,0x7D,0x7D,0x3D,0x3D,0x3D,0x3F,0x3F,0x3F,0x3D,
0x3D,0x3D,0x7D,0x7D,0x7D,0xF9,0xFB,0xF3,0xF3,0xE7,0xE7,0xC7,0xCF,0x1F,0x3F,0x7F,
0xFE,0xFE,0xFE,0xFF,0xFF,0xDF,0x0F,0x07,0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0xFE,0xFF,0xFF,0xFF,0xFF,0x0F,0x01,0xF0,0xFE,0xFF,0xFF,0xFF,0xFF,0x87,
0xC3,0xE1,0xE1,0xE0,0xE0,0xE0,0xE0,0xE0,0xC0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x07,0x1F,0xFF,0xFF,0xFF,0xFF,0xF8,0x00,
0x07,0x1F,0xFF,0xFF,0xFF,0xFF,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0x01,0x01,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,
0x3F,0x3F,0x7F,0x7F,0x78,0x78,0x78,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,
0x78,0x78,0x78,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,
0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x79,0x78,0x78,0x78,0x7F,
0x3F,0x3F,0x3F,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};


void Init()
{
  BoardInitMcu();
  BoardInitPeriph();
  keys_init(); // 按键初始化
  setTimer2Callback(Time2Handler);
  Tim2McuInit(1); // 定时器初始化，设置定时中断1ms中断一次

  OLED_Init();
  OLED_Display_On();

  setBreathLedArg(100,50);
  startLedBreath();
}

/**
 * Main application entry point.
 */
int main(void)
{
  Init();
  OLED_DrawBMP(128/2-58/2,1,59,48,bmp1);
  while (1)
  {
    
    if (HAL_GPIO_ReadPin(KEY2_GPIO,KEY2_GPIO_PIN) == GPIO_PIN_RESET)
    {
      keyID = 1;
    }else if (HAL_GPIO_ReadPin(KEY3_GPIO,KEY3_GPIO_PIN) == GPIO_PIN_RESET)
    {
      keyID = 2;
    }
    else
    {
      keyID = 0;
    }


    if (modeId!=keyID)
    {
      modeId = keyID;
      OLED_Clear();
      switch (modeId)
      {
        case 0:
          OLED_DrawBMP(128/2-58/2,1,59,48,bmp1);
          break;
        case 1:
          OLED_DrawBMP(128/2-64/2,64/2-64/2,64,64,bmp2);
          break;
        case 2:
          OLED_DrawBMP(128/2-63/2,64/2-64/2,63,64,bmp3);
          break;
      }
    }

    switch (modeId)
      {
        case 0:
          GpioWrite(&Led2,1);
          break;
        case 1:
          breathLed();
          break;
        case 2:
          GpioWrite(&Led2,0);
          break;
      }
  }
}
